@ref "./CobraBinding/bin/Debug/MonoDevelop.CobraBinding.dll"

use MonoDevelop.CobraBinding

class TestPerformance

	def main
		# setup the input data to the compiler
		sourceMap = Dictionary<of String, String>()
		directories = _getDirectories
		
		for dir in directories
			for file in Directory.enumerateFiles(dir, "*.cobra")
				sourceCode = StreamReader(file).readToEnd
				sourceMap.add(file, sourceCode)
		
		refs = List<of String>()
		for asmRef in Directory.enumerateFiles("./CobraBinding/scripts/refs")
			refs.add(asmRef)
		
		# compile the files
		for i in 10
			print "Pass #[i+1]"
			cm = CompilerManager.instance
			cm.parseAndBind(sourceMap, refs)
		
	def _getDirectories as List<of String>
		"""Return all directories under the current working directory"""
		return _getDirectories("./")
	
	def _getDirectories(fromDir as String) as List<of String>
		directories = List<of String>()
		
		for dir in Directory.getDirectories(fromDir)
			directories.add(dir)
		
		for dir in directories.clone
			directories.addRange(_getDirectories(dir))
		
		return directories
